# Auth API Endpoints
# OpenAPI 3.0 Path Definitions

/auth/register:
  post:
    tags:
      - Authentication
    summary: Register a new user
    description: Create a new user account with email and password
    operationId: register
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - email
              - password
            properties:
              email:
                type: string
                format: email
                example: user@example.com
              password:
                type: string
                format: password
                minLength: 8
                example: SecurePass123!
              firstName:
                type: string
                maxLength: 100
                example: John
              lastName:
                type: string
                maxLength: 100
                example: Doe
    responses:
      '201':
        description: User registered successfully
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthResponse'
      '400':
        description: Validation error (invalid email, password too short)
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidationError'
      '409':
        description: Email already exists
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'

/auth/login:
  post:
    tags:
      - Authentication
    summary: Login with email and password
    description: Authenticate user and return JWT access and refresh tokens
    operationId: login
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - email
              - password
            properties:
              email:
                type: string
                format: email
                example: user@example.com
              password:
                type: string
                format: password
                example: SecurePass123!
    responses:
      '200':
        description: Login successful
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthResponse'
      '401':
        description: Invalid credentials or user inactive
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'

/auth/refresh:
  post:
    tags:
      - Authentication
    summary: Refresh access token
    description: Exchange a valid refresh token for new access and refresh tokens
    operationId: refreshTokens
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - refreshToken
            properties:
              refreshToken:
                type: string
                description: The refresh token received from login
                example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    responses:
      '200':
        description: Tokens refreshed successfully
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthResponse'
      '401':
        description: Invalid or expired refresh token
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'

/auth/logout:
  post:
    tags:
      - Authentication
    summary: Logout current session
    description: Invalidate the current session and refresh token
    operationId: logout
    security:
      - bearerAuth: []
    requestBody:
      required: false
      content:
        application/json:
          schema:
            type: object
            properties:
              refreshToken:
                type: string
                description: Optional refresh token to invalidate specific session
    responses:
      '200':
        description: Logged out successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: Logged out successfully
      '401':
        description: Not authenticated
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'

/auth/me:
  get:
    tags:
      - Authentication
    summary: Get current user profile
    description: Return the authenticated user's profile information
    operationId: getCurrentUser
    security:
      - bearerAuth: []
    responses:
      '200':
        description: Current user profile
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      '401':
        description: Not authenticated
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Error'

# Component Schemas
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
        email:
          type: string
          format: email
          example: user@example.com
        firstName:
          type: string
          example: John
        lastName:
          type: string
          example: Doe
        avatarUrl:
          type: string
          format: uri
          nullable: true
        isActive:
          type: boolean
          example: true
        emailVerifiedAt:
          type: string
          format: date-time
          nullable: true
        lastLoginAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AuthResponse:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT access token (15 min expiry)
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refreshToken:
          type: string
          description: JWT refresh token (7 day expiry)
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        expiresIn:
          type: integer
          description: Access token expiry in seconds
          example: 900
        user:
          $ref: '#/components/schemas/User'

    Error:
      type: object
      properties:
        statusCode:
          type: integer
          example: 401
        message:
          type: string
          example: Invalid credentials
        error:
          type: string
          example: Unauthorized

    ValidationError:
      type: object
      properties:
        statusCode:
          type: integer
          example: 400
        message:
          type: array
          items:
            type: string
          example:
            - email must be a valid email
            - password must be at least 8 characters
        error:
          type: string
          example: Bad Request
